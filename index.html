<html>
  <head>
    <title>GovHouseVRTour</title>
    <style>body { margin: 0; }</style>
    <meta charset="utf-8">
<title>Hello, WebVR! • A-Frame</title>
<meta name="description" content="Hello, WebVR! • A-Frame">
<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<!--animation component script-->
<script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
<script src="https://unpkg.com/aframe-look-at-component@0.5.1/dist/aframe-look-at-component.min.js"></script>
<script src="panels.js"></script>
<script>
  AFRAME.registerComponent('hotspots',{
    init:function(){
        this.el.addEventListener('reloadspots',function(evt){

        //get the entire current spot group and scale it to 0
        var currspotgroup=document.getElementById(evt.detail.currspots);
        currspotgroup.setAttribute("scale","0 0 0");

        //get the entire new spot group and scale it to 1
        var newspotgroup=document.getElementById(evt.detail.newspots);
        newspotgroup.setAttribute("scale","1 1 1");
      });
    }
  });
  AFRAME.registerComponent('spot',{
    schema:{
      linkto:{type:"string",default:""},
      spotgroup:{type:"string",default:""}
    },
    init:function(){

      //add image source of door icon
      this.el.setAttribute("src","#door");
      //make the icon look at the camera all the time
      this.el.setAttribute("look-at","#cam");


      var data=this.data;

      this.el.addEventListener('click',function(){
        //set the skybox source to the new image as per the spot
        var sky=document.getElementById("skybox");
        sky.setAttribute("src",data.linkto);

        var spotcomp=document.getElementById("spots");
        var currspots=this.parentElement.getAttribute("id");
        //create event for spots component to change the spots data
        spotcomp.emit('reloadspots',{newspots:data.spotgroup,currspots:currspots});
      });
    }
  });
</script>
  </head>
  <body>
    <!-- Attachment point for your app -->
    <div id="container"></div>
    <script src="./client.bundle?platform=vr"></script>
    <script>
      // Initialize the React 360 application
      React360.init(
        'index.bundle?platform=vr&dev=true',
        document.getElementById('container'),
        {
          assetRoot: 'static_assets/',
        }
      );
    </script>
    <a-scene background="color: #FAFAFA">
      <!-- loading assets -->
      <a-assets>
        <img id="bedroom" src="static_assets\QueensBedroom1.jpg"/>
        <img id="cellar" src="static_assets\cellar.jpg"/>
        <img id="bathroom" src="static_assets\QueensBedroom2.jpg"/>
        <img id="cellar" src="static_assets\cellar.jpg"/>
        <img id="hallway-cellar" src="static_assets\InFrontOfCellar.jpg"/>
        <img id="queens-entryway" src="static_assets\QueensEntryRoom.jpg"/>
        <img id="door" src="static_assets\door.png"/>
        <img id="info-icon" src="static_assets\info.png"/>
      </a-assets>
      <!-- initial starting room -->
      <a-sky id="skybox" src="#bedroom"></a-sky>
      <!-- creating target reticle -->
      <a-entity id="cam" camera position="0 1.6 0" look-controls>
        <a-entity cursor="fuse:true;fuseTimeout:2000"
                  geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.02"
                  position="0 0 -1.8"
                  material="shader:flat;color:#ff0000"
                  animation__mouseenter="property:scale;to:3 3 3;startEvents:mouseenter;endEvents:mouseleave;dir:reverse;dur:2000;loop:1">
        </a-entity>
      </a-entity>
      <!-- show icons in each photo -->
      <a-entity id="spots" hotspots>
        <!-- spot group for Queen's bedroom - show these images when user is in Queen's Bedroom -->
        <a-entity id="group-bedroom">
          <!-- link icons to other rooms-->
          <a-image spot="linkto:#bathroom;spotgroup:group-bathroom" position="1 1 10"></a-image>
          <a-image spot="linkto:#queens-entryway;spotgroup:group-entryway" position="9 1 7"></a-image>
          <a-image src="static_assets\info.png" position="-10 4 4" look-at="#cam"></a-image>
          <a-image src="static_assets\info.png" position="-3 2 7" look-at="#cam"></a-image>
          <a-image id="carpet" cursor-listener src="static_assets\info.png" position="5 -1 0" look-at="#cam"></a-image>
          <a-image id="carpet-info" src="static_assets\kashan-rug.png" position="5 -1 0" look-at="#cam" scale="4 2 2" visible="false"></a-image>
        </a-entity>
        <!-- spot group for cellar - show these images when user is in the cellar -->
        <a-entity id="group-cellar" scale="0 0 0">
          <!-- link icons to other rooms-->
          <a-image spot="linkto:#hallway-cellar;spotgroup:group-hallway-cellar" position="-5 1 -8"></a-image>
          <a-image src="static_assets\info.png" position="10 0 0" look-at="#cam"></a-image>
          <a-image src="static_assets\info.png" position="-3 1 4" look-at="#cam"></a-image>
          <a-image src="static_assets\info.png" position="5 2 -4" look-at="#cam"></a-image>
        </a-entity>
        <a-entity id="group-bathroom" scale="0 0 0">
          <a-image spot="linkto:#bedroom;spotgroup:group-bedroom" position="10 0 -8"></a-image>
        </a-entity>
        <a-entity id="group-entryway" scale="0 0 0">
          <a-image spot="linkto:#hallway-cellar;spotgroup:group-hallway-cellar" position="0 1 -8"></a-image>
          <a-image src="static_assets\info.png" position="-7 2 7" look-at="#cam"></a-image>
        </a-entity>
        <a-entity id="group-hallway-cellar" scale="0 0 0">
          <a-image spot="linkto:#cellar;spotgroup:group-cellar" position="0 0 2"></a-image>
        </a-entity>
      </a-entity>
    </a-scene>
    <script>

      </script>
  </body>
</html>
